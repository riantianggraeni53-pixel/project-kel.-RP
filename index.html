<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limit Fungsi Challenge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3949ab 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: #bb86fc;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #c5cae9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .game-panel, .leaderboard-panel {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .game-panel {
            flex: 1;
            min-width: 300px;
        }
        
        .leaderboard-panel {
            flex: 1;
            min-width: 300px;
        }
        
        .panel-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #bb86fc;
            border-bottom: 2px solid rgba(187, 134, 252, 0.5);
            padding-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            flex: 1;
            min-width: 150px;
            transition: transform 0.3s, background 0.3s;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #bb86fc;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 1rem;
            color: #c5cae9;
        }
        
        .problem-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid rgba(187, 134, 252, 0.3);
        }
        
        .problem-text {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #fff;
        }
        
        .problem-equation {
            font-size: 2.5rem;
            font-weight: bold;
            color: #bb86fc;
            margin: 25px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-family: 'Cambria Math', serif;
        }
        
        .answer-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .answer-options {
                grid-template-columns: 1fr;
            }
        }
        
        .answer-btn {
            padding: 18px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #fff;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Cambria Math', serif;
        }
        
        .answer-btn:hover {
            background: rgba(187, 134, 252, 0.3);
            border-color: #bb86fc;
            transform: scale(1.03);
        }
        
        .answer-btn.correct {
            background: rgba(76, 175, 80, 0.7);
            border-color: #4caf50;
        }
        
        .answer-btn.incorrect {
            background: rgba(244, 67, 54, 0.7);
            border-color: #f44336;
        }
        
        .timer-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            margin-top: 15px;
            overflow: hidden;
        }
        
        .timer-progress {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #bb86fc);
            width: 100%;
            transition: width 1s linear;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: #bb86fc;
            color: #121212;
        }
        
        .btn-primary:hover {
            background: #9a67ea;
            transform: scale(1.05);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .leaderboard-list {
            margin-top: 20px;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        
        .leaderboard-item:hover {
            background: rgba(0, 0, 0, 0.3);
            transform: translateX(5px);
        }
        
        .leaderboard-item.rank-1 {
            background: rgba(255, 215, 0, 0.15);
            border-left: 5px solid gold;
        }
        
        .leaderboard-item.rank-2 {
            background: rgba(192, 192, 192, 0.15);
            border-left: 5px solid silver;
        }
        
        .leaderboard-item.rank-3 {
            background: rgba(205, 127, 50, 0.15);
            border-left: 5px solid #cd7f32;
        }
        
        .player-rank {
            font-size: 1.5rem;
            font-weight: bold;
            width: 40px;
            text-align: center;
            color: #bb86fc;
        }
        
        .player-info {
            flex: 1;
            padding-left: 15px;
        }
        
        .player-name {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .player-date {
            font-size: 0.9rem;
            color: #c5cae9;
        }
        
        .player-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #bb86fc;
        }
        
        .game-rules {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
        }
        
        .rules-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #bb86fc;
        }
        
        .rules-list {
            padding-left: 20px;
        }
        
        .rules-list li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .highlight {
            color: #bb86fc;
            font-weight: bold;
        }
        
        .hidden {
            display: none;
        }
        
        .game-over {
            text-align: center;
            padding: 30px;
        }
        
        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #bb86fc;
        }
        
        .final-score {
            font-size: 3rem;
            font-weight: bold;
            color: #4caf50;
            margin: 20px 0;
        }
        
        .name-input {
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(187, 134, 252, 0.5);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1.2rem;
            width: 100%;
            max-width: 400px;
            margin: 20px 0;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #c5cae9;
            font-size: 0.9rem;
        }
        
        .feedback {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 15px;
            min-height: 30px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .feedback.correct {
            color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .feedback.incorrect {
            color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .difficulty-btn {
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .difficulty-btn.active {
            background: #bb86fc;
            color: #121212;
            border-color: #bb86fc;
        }
        
        .difficulty-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-infinity"></i> Limit Fungsi Challenge</h1>
            <p class="tagline">Uji kemampuan matematika Anda dengan menyelesaikan soal-soal limit fungsi. Jawab dengan cepat dan benar untuk mendapatkan skor tertinggi!</p>
        </header>
        
        <div class="game-area">
            <div class="game-panel">
                <h2 class="panel-title"><i class="fas fa-gamepad"></i> Arena Permainan</h2>
                
                <div class="stats-container">
                    <div class="stat-box">
                        <div class="stat-value" id="score">0</div>
                        <div class="stat-label">Skor</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="time">30</div>
                        <div class="stat-label">Waktu Tersisa</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="question">1/10</div>
                        <div class="stat-label">Soal</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="streak">0</div>
                        <div class="stat-label">Jawaban Benar Beruntun</div>
                    </div>
                </div>
                
                <div class="problem-container" id="problem-container">
                    <p class="problem-text">Selesaikan limit fungsi berikut:</p>
                    <div class="problem-equation" id="problem-equation">lim<sub>x→2</sub> (x² - 4)/(x - 2)</div>
                    <p class="problem-text">Pilih jawaban yang benar:</p>
                    
                    <div class="answer-options" id="answer-options">
                        <!-- Opsi jawaban akan diisi oleh JavaScript -->
                    </div>
                    
                    <div class="timer-bar">
                        <div class="timer-progress" id="timer-progress"></div>
                    </div>
                    
                    <div class="feedback" id="feedback"></div>
                </div>
                
                <div class="game-over hidden" id="game-over">
                    <h2>Permainan Selesai!</h2>
                    <p>Selamat, Anda telah menyelesaikan semua soal.</p>
                    <div class="final-score" id="final-score">0</div>
                    
                    <p>Masukkan nama Anda untuk papan peringkat:</p>
                    <input type="text" class="name-input" id="player-name" placeholder="Nama Anda" maxlength="20">
                    
                    <div class="controls">
                        <button class="btn btn-primary" id="save-score-btn">
                            <i class="fas fa-trophy"></i> Simpan Skor
                        </button>
                        <button class="btn btn-secondary" id="restart-btn">
                            <i class="fas fa-redo"></i> Main Lagi
                        </button>
                    </div>
                </div>
                
                <div class="difficulty-selector">
                    <div class="difficulty-btn active" data-level="easy">Mudah</div>
                    <div class="difficulty-btn" data-level="medium">Sedang</div>
                    <div class="difficulty-btn" data-level="hard">Sulit</div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="start-btn">
                        <i class="fas fa-play"></i> Mulai Permainan
                    </button>
                    <button class="btn btn-secondary" id="hint-btn">
                        <i class="fas fa-lightbulb"></i> Petunjuk
                    </button>
                    <button class="btn btn-secondary" id="skip-btn">
                        <i class="fas fa-forward"></i> Lewati Soal
                    </button>
                </div>
                
                <div class="game-rules">
                    <h3 class="rules-title"><i class="fas fa-info-circle"></i> Cara Bermain</h3>
                    <ul class="rules-list">
                        <li>Pilih tingkat kesulitan: <span class="highlight">Mudah</span>, <span class="highlight">Sedang</span>, atau <span class="highlight">Sulit</span>.</li>
                        <li>Klik <span class="highlight">Mulai Permainan</span> untuk memulai.</li>
                        <li>Selesaikan soal limit fungsi dengan memilih jawaban yang benar.</li>
                        <li>Setiap soal memiliki waktu <span class="highlight">30 detik</span> untuk dijawab.</li>
                        <li>Jawaban benar: <span class="highlight">+10 poin</span> + bonus waktu.</li>
                        <li>Jawaban salah: <span class="highlight">0 poin</span> dan lanjut ke soal berikutnya.</li>
                        <li>Jawaban benar beruntun memberikan <span class="highlight">poin bonus</span>.</li>
                        <li>Setelah 10 soal, permainan berakhir dan skor Anda dapat disimpan di papan peringkat.</li>
                    </ul>
                </div>
            </div>
            
            <div class="leaderboard-panel">
                <h2 class="panel-title"><i class="fas fa-trophy"></i> Papan Peringkat</h2>
                
                <div class="leaderboard-list" id="leaderboard-list">
                    <!-- Data papan peringkat akan diisi oleh JavaScript -->
                </div>
                
                <div class="controls">
                    <button class="btn btn-secondary" id="clear-leaderboard-btn">
                        <i class="fas fa-trash"></i> Hapus Papan Peringkat
                    </button>
                </div>
                
                <div class="game-rules">
                    <h3 class="rules-title"><i class="fas fa-graduation-cap"></i> Materi Limit Fungsi</h3>
                    <ul class="rules-list">
                        <li><span class="highlight">Limit fungsi</span> adalah nilai yang didekati oleh fungsi ketika variabel mendekati suatu titik.</li>
                        <li>Beberapa teknik penyelesaian limit:
                            <ul>
                                <li><span class="highlight">Substitusi langsung</span>: mengganti nilai variabel dengan nilai yang didekati.</li>
                                <li><span class="highlight">Pemfaktoran</span>: menyederhanakan bentuk aljabar.</li>
                                <li><span class="highlight">Perkalian sekawan</span>: untuk limit yang mengandung akar.</li>
                                <li><span class="highlight">Aturan L'Hôpital</span>: untuk bentuk tak tentu 0/0 atau ∞/∞.</li>
                            </ul>
                        </li>
                        <li>Contoh: lim<sub>x→2</sub> (x² - 4)/(x - 2) = lim<sub>x→2</sub> (x-2)(x+2)/(x-2) = lim<sub>x→2</sub> (x+2) = 4</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Game Limit Fungsi Challenge &copy; 2023 | Dibuat untuk pembelajaran matematika</p>
            <p>Gunakan browser terbaru untuk pengalaman terbaik</p>
        </footer>
    </div>

    <script>
        // Data soal berdasarkan tingkat kesulitan
        const problems = {
            easy: [
                {
                    question: "lim<sub>x→3</sub> (2x + 1)",
                    answers: ["5", "6", "7", "8"],
                    correct: 2, // Indeks jawaban benar (0-based)
                    explanation: "Substitusi langsung: 2(3) + 1 = 7"
                },
                {
                    question: "lim<sub>x→4</sub> (x² - 16)/(x - 4)",
                    answers: ["4", "6", "8", "10"],
                    correct: 2,
                    explanation: "Faktorkan: (x-4)(x+4)/(x-4) = x+4, substitusi x=4: 4+4=8"
                },
                {
                    question: "lim<sub>x→0</sub> (5x)/x",
                    answers: ["0", "1", "5", "Tidak terdefinisi"],
                    correct: 2,
                    explanation: "Sederhanakan: 5x/x = 5, limitnya adalah 5"
                },
                {
                    question: "lim<sub>x→1</sub> (x³ - 1)/(x - 1)",
                    answers: ["1", "2", "3", "4"],
                    correct: 2,
                    explanation: "Gunakan pemfaktoran: (x-1)(x²+x+1)/(x-1) = x²+x+1, substitusi x=1: 1+1+1=3"
                },
                {
                    question: "lim<sub>x→∞</sub> (3x + 5)/x",
                    answers: ["0", "3", "5", "∞"],
                    correct: 1,
                    explanation: "Bagi pembilang dan penyebut dengan x: (3 + 5/x)/1, saat x→∞, 5/x→0, jadi limitnya 3"
                }
            ],
            medium: [
                {
                    question: "lim<sub>x→2</sub> (√(x+2) - 2)/(x-2)",
                    answers: ["1/4", "1/2", "1", "2"],
                    correct: 0,
                    explanation: "Kalikan sekawan: [√(x+2)-2][√(x+2)+2]/[(x-2)(√(x+2)+2)] = (x-2)/[(x-2)(√(x+2)+2)] = 1/(√(x+2)+2), substitusi x=2: 1/(2+2)=1/4"
                },
                {
                    question: "lim<sub>x→0</sub> sin(3x)/x",
                    answers: ["0", "1", "3", "Tidak ada"],
                    correct: 2,
                    explanation: "Gunakan sifat limit: lim sin(kx)/x = k, jadi lim sin(3x)/x = 3"
                },
                {
                    question: "lim<sub>x→0</sub> (1 - cos x)/x",
                    answers: ["0", "1", "1/2", "∞"],
                    correct: 0,
                    explanation: "Gunakan identitas trigonometri atau aturan L'Hôpital: turunan pembilang = sin x, turunan penyebut = 1, lim sin x/1 = 0"
                },
                {
                    question: "lim<sub>x→∞</sub> (2x² - 3x + 1)/(x² + 5)",
                    answers: ["0", "1", "2", "∞"],
                    correct: 2,
                    explanation: "Bagi pembilang dan penyebut dengan x²: (2 - 3/x + 1/x²)/(1 + 5/x²), saat x→∞, limitnya = 2/1 = 2"
                },
                {
                    question: "lim<sub>x→1</sub> (x⁴ - 1)/(x³ - 1)",
                    answers: ["4/3", "3/2", "2", "3"],
                    correct: 0,
                    explanation: "Faktorkan: (x²-1)(x²+1)/(x-1)(x²+x+1) = (x-1)(x+1)(x²+1)/(x-1)(x²+x+1) = (x+1)(x²+1)/(x²+x+1), substitusi x=1: (2×2)/3 = 4/3"
                }
            ],
            hard: [
                {
                    question: "lim<sub>x→0</sub> (e<sup>2x</sup> - 1)/x",
                    answers: ["0", "1", "2", "e²"],
                    correct: 2,
                    explanation: "Gunakan aturan L'Hôpital: turunan pembilang = 2e^(2x), turunan penyebut = 1, lim 2e^(2x)/1 = 2e^0 = 2"
                },
                {
                    question: "lim<sub>x→∞</sub> (ln(x+1) - ln x)",
                    answers: ["0", "1", "e", "∞"],
                    correct: 0,
                    explanation: "Gunakan sifat logaritma: ln((x+1)/x) = ln(1 + 1/x), saat x→∞, 1/x→0, jadi ln(1+0)=ln 1=0"
                },
                {
                    question: "lim<sub>x→π/2</sub> (tan x - sec x)",
                    answers: ["0", "1", "-1", "Tidak ada"],
                    correct: 2,
                    explanation: "Ubah ke sin/cos: tan x - sec x = sin x/cos x - 1/cos x = (sin x - 1)/cos x, substitusi x=π/2: (1-1)/0 = 0/0 (bentuk tak tentu). Gunakan L'Hôpital: turunan pembilang = cos x, turunan penyebut = -sin x, lim cos x/(-sin x) = cot x, saat x→π/2, cot(π/2)=0"
                },
                {
                    question: "lim<sub>x→0</sub> (a<sup>x</sup> - b<sup>x</sup>)/x (a,b>0)",
                    answers: ["ln a - ln b", "a - b", "ln(a/b)", "ln(b/a)"],
                    correct: 2,
                    explanation: "Gunakan aturan L'Hôpital: turunan pembilang = a^x ln a - b^x ln b, turunan penyebut = 1, lim (a^x ln a - b^x ln b)/1 = ln a - ln b = ln(a/b)"
                },
                {
                    question: "lim<sub>x→∞</sub> (1 + 3/x)<sup>2x</sup>",
                    answers: ["1", "e³", "e⁶", "∞"],
                    correct: 2,
                    explanation: "Ingat sifat: lim (1 + k/x)^(mx) = e^(km). Jadi lim (1 + 3/x)^(2x) = e^(3×2) = e⁶"
                }
            ]
        };

        // Variabel game
        let currentScore = 0;
        let currentQuestion = 0;
        let totalQuestions = 10;
        let timeLeft = 30;
        let timerInterval;
        let gameActive = false;
        let correctStreak = 0;
        let currentDifficulty = 'easy';
        let playerAnswers = [];
        
        // Elemen DOM
        const scoreElement = document.getElementById('score');
        const timeElement = document.getElementById('time');
        const questionElement = document.getElementById('question');
        const streakElement = document.getElementById('streak');
        const problemEquationElement = document.getElementById('problem-equation');
        const answerOptionsElement = document.getElementById('answer-options');
        const timerProgressElement = document.getElementById('timer-progress');
        const feedbackElement = document.getElementById('feedback');
        const startButton = document.getElementById('start-btn');
        const hintButton = document.getElementById('hint-btn');
        const skipButton = document.getElementById('skip-btn');
        const gameOverElement = document.getElementById('game-over');
        const problemContainerElement = document.getElementById('problem-container');
        const finalScoreElement = document.getElementById('final-score');
        const playerNameInput = document.getElementById('player-name');
        const saveScoreButton = document.getElementById('save-score-btn');
        const restartButton = document.getElementById('restart-btn');
        const leaderboardListElement = document.getElementById('leaderboard-list');
        const clearLeaderboardButton = document.getElementById('clear-leaderboard-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');

        // Inisialisasi
        function init() {
            loadLeaderboard();
            updateLeaderboard();
            setupEventListeners();
            generateProblem();
        }

        // Setup event listeners
        function setupEventListeners() {
            startButton.addEventListener('click', startGame);
            hintButton.addEventListener('click', showHint);
            skipButton.addEventListener('click', skipQuestion);
            saveScoreButton.addEventListener('click', saveScore);
            restartButton.addEventListener('click', restartGame);
            clearLeaderboardButton.addEventListener('click', clearLeaderboard);
            
            difficultyButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (gameActive) return;
                    
                    difficultyButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDifficulty = this.dataset.level;
                    generateProblem();
                });
            });
        }

        // Mulai permainan
        function startGame() {
            if (gameActive) return;
            
            gameActive = true;
            currentScore = 0;
            currentQuestion = 1;
            correctStreak = 0;
            playerAnswers = [];
            timeLeft = 30;
            
            updateUI();
            generateProblem();
            startTimer();
            
            startButton.disabled = true;
            startButton.innerHTML = '<i class="fas fa-play"></i> Sedang Berlangsung...';
        }

        // Generate soal baru
        function generateProblem() {
            if (!gameActive) {
                // Jika game belum dimulai, tampilkan soal contoh
                const problemSet = problems[currentDifficulty];
                const randomProblem = problemSet[Math.floor(Math.random() * problemSet.length)];
                
                problemEquationElement.innerHTML = randomProblem.question;
                
                // Tampilkan opsi jawaban
                answerOptionsElement.innerHTML = '';
                randomProblem.answers.forEach((answer, index) => {
                    const button = document.createElement('button');
                    button.className = 'answer-btn';
                    button.textContent = answer;
                    button.addEventListener('click', () => {
                        if (!gameActive) {
                            alert('Klik "Mulai Permainan" untuk memulai!');
                        }
                    });
                    answerOptionsElement.appendChild(button);
                });
                
                return;
            }
            
            // Jika game aktif, pilih soal secara acak dari tingkat kesulitan yang dipilih
            const problemSet = problems[currentDifficulty];
            const randomProblem = problemSet[Math.floor(Math.random() * problemSet.length)];
            
            problemEquationElement.innerHTML = randomProblem.question;
            
            // Tampilkan opsi jawaban
            answerOptionsElement.innerHTML = '';
            randomProblem.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.addEventListener('click', () => checkAnswer(index, randomProblem.correct, randomProblem.explanation));
                answerOptionsElement.appendChild(button);
            });
            
            // Reset feedback dan timer
            feedbackElement.textContent = '';
            feedbackElement.className = 'feedback';
            timeLeft = 30;
            timerProgressElement.style.width = '100%';
            timerProgressElement.style.transition = 'width 30s linear';
            
            // Update UI
            updateUI();
        }

        // Periksa jawaban
        function checkAnswer(selectedIndex, correctIndex, explanation) {
            if (!gameActive) return;
            
            const answerButtons = document.querySelectorAll('.answer-btn');
            const selectedButton = answerButtons[selectedIndex];
            const correctButton = answerButtons[correctIndex];
            
            // Tandai jawaban yang dipilih dan jawaban yang benar
            selectedButton.classList.add(selectedIndex === correctIndex ? 'correct' : 'incorrect');
            if (selectedIndex !== correctIndex) {
                correctButton.classList.add('correct');
            }
            
            // Nonaktifkan semua tombol
            answerButtons.forEach(btn => {
                btn.disabled = true;
                btn.style.cursor = 'not-allowed';
            });
            
            // Tampilkan feedback
            if (selectedIndex === correctIndex) {
                // Jawaban benar
                const pointsEarned = 10 + Math.floor(timeLeft / 3); // Bonus waktu
                currentScore += pointsEarned;
                correctStreak++;
                
                feedbackElement.textContent = `Benar! +${pointsEarned} poin. ${explanation}`;
                feedbackElement.className = 'feedback correct';
                
                // Bonus untuk jawaban benar beruntun
                if (correctStreak >= 3) {
                    const streakBonus = correctStreak * 5;
                    currentScore += streakBonus;
                    feedbackElement.textContent += ` | ${correctStreak} jawaban benar beruntun! +${streakBonus} poin bonus!`;
                }
            } else {
                // Jawaban salah
                feedbackElement.textContent = `Salah. Jawaban yang benar: ${correctButton.textContent}. ${explanation}`;
                feedbackElement.className = 'feedback incorrect';
                correctStreak = 0;
            }
            
            // Simpan jawaban
            playerAnswers.push({
                question: problemEquationElement.textContent,
                selected: selectedButton.textContent,
                correct: correctButton.textContent,
                isCorrect: selectedIndex === correctIndex
            });
            
            // Update UI
            updateUI();
            
            // Lanjut ke soal berikutnya setelah 3 detik
            clearInterval(timerInterval);
            setTimeout(nextQuestion, 3000);
        }

        // Lanjut ke soal berikutnya
        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion > totalQuestions) {
                endGame();
            } else {
                generateProblem();
                startTimer();
            }
        }

        // Lewati soal
        function skipQuestion() {
            if (!gameActive) return;
            
            // Tidak ada penalti untuk melewatkan soal
            feedbackElement.textContent = "Soal dilewati. Tidak ada penalti.";
            feedbackElement.className = 'feedback';
            
            // Simpan bahwa soal dilewati
            playerAnswers.push({
                question: problemEquationElement.textContent,
                selected: "Dilewati",
                correct: "Tidak dijawab",
                isCorrect: false
            });
            
            nextQuestion();
        }

        // Tampilkan petunjuk
        function showHint() {
            if (!gameActive) return;
            
            // Kurangi waktu 5 detik untuk petunjuk
            timeLeft = Math.max(5, timeLeft - 5);
            timerProgressElement.style.width = `${(timeLeft / 30) * 100}%`;
            timerProgressElement.style.transition = 'width 0.5s linear';
            
            // Tampilkan petunjuk umum
            const hints = [
                "Coba substitusi langsung nilai x ke dalam fungsi.",
                "Periksa apakah fungsi dapat disederhanakan dengan pemfaktoran.",
                "Untuk limit x→∞, bagi setiap suku dengan pangkat tertinggi x.",
                "Untuk bentuk tak tentu 0/0, coba gunakan aturan L'Hôpital atau pemfaktoran.",
                "Ingat sifat-sifat limit trigonometri seperti lim sin x/x = 1 untuk x→0."
            ];
            
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            feedbackElement.textContent = `Petunjuk: ${randomHint} (Waktu berkurang 5 detik)`;
            feedbackElement.className = 'feedback';
        }

        // Mulai timer
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 30;
            timerProgressElement.style.width = '100%';
            timerProgressElement.style.transition = 'width 30s linear';
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timerProgressElement.style.width = `${(timeLeft / 30) * 100}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    
                    // Waktu habis
                    feedbackElement.textContent = "Waktu habis! Soal akan dilanjutkan.";
                    feedbackElement.className = 'feedback incorrect';
                    
                    // Simpan bahwa waktu habis
                    playerAnswers.push({
                        question: problemEquationElement.textContent,
                        selected: "Waktu habis",
                        correct: "Tidak dijawab",
                        isCorrect: false
                    });
                    
                    correctStreak = 0;
                    streakElement.textContent = correctStreak;
                    
                    setTimeout(nextQuestion, 2000);
                }
                
                updateUI();
            }, 1000);
        }

        // Update UI
        function updateUI() {
            scoreElement.textContent = currentScore;
            timeElement.textContent = timeLeft;
            questionElement.textContent = `${currentQuestion}/${totalQuestions}`;
            streakElement.textContent = correctStreak;
        }

        // Akhiri permainan
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            
            // Tampilkan layar game over
            problemContainerElement.classList.add('hidden');
            gameOverElement.classList.remove('hidden');
            
            finalScoreElement.textContent = currentScore;
            
            // Reset tombol mulai
            startButton.disabled = false;
            startButton.innerHTML = '<i class="fas fa-play"></i> Mulai Permainan';
        }

        // Simpan skor ke leaderboard
        function saveScore() {
            const playerName = playerNameInput.value.trim() || "Anonim";
            
            if (playerName === "") {
                alert("Masukkan nama Anda!");
                return;
            }
            
            // Ambil leaderboard dari localStorage
            let leaderboard = JSON.parse(localStorage.getItem('limitFungsiLeaderboard')) || [];
            
            // Tambahkan skor baru
            const newScore = {
                name: playerName,
                score: currentScore,
                date: new Date().toLocaleDateString('id-ID'),
                difficulty: currentDifficulty
            };
            
            leaderboard.push(newScore);
            
            // Urutkan berdasarkan skor (tertinggi ke terendah)
            leaderboard.sort((a, b) => b.score - a.score);
            
            // Simpan hanya 10 teratas
            leaderboard = leaderboard.slice(0, 10);
            
            // Simpan ke localStorage
            localStorage.setItem('limitFungsiLeaderboard', JSON.stringify(leaderboard));
            
            // Update tampilan leaderboard
            updateLeaderboard();
            
            // Tampilkan konfirmasi
            alert(`Skor ${currentScore} berhasil disimpan untuk ${playerName}!`);
            
            // Reset input nama
            playerNameInput.value = "";
        }

        // Muat leaderboard
        function loadLeaderboard() {
            return JSON.parse(localStorage.getItem('limitFungsiLeaderboard')) || [];
        }

        // Update tampilan leaderboard
        function updateLeaderboard() {
            const leaderboard = loadLeaderboard();
            leaderboardListElement.innerHTML = '';
            
            if (leaderboard.length === 0) {
                leaderboardListElement.innerHTML = '<div class="leaderboard-item"><div class="player-info">Belum ada skor yang disimpan. Mainkan game dan simpan skor Anda!</div></div>';
                return;
            }
            
            leaderboard.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = `leaderboard-item rank-${index + 1}`;
                
                item.innerHTML = `
                    <div class="player-rank">${index + 1}</div>
                    <div class="player-info">
                        <div class="player-name">${entry.name}</div>
                        <div class="player-date">${entry.date} (${entry.difficulty})</div>
                    </div>
                    <div class="player-score">${entry.score}</div>
                `;
                
                leaderboardListElement.appendChild(item);
            });
        }

        // Hapus leaderboard
        function clearLeaderboard() {
            if (confirm("Apakah Anda yakin ingin menghapus semua data papan peringkat?")) {
                localStorage.removeItem('limitFungsiLeaderboard');
                updateLeaderboard();
                alert("Papan peringkat telah dihapus.");
            }
        }

        // Mulai ulang permainan
        function restartGame() {
            // Sembunyikan layar game over
            gameOverElement.classList.add('hidden');
            problemContainerElement.classList.remove('hidden');
            
            // Mulai permainan baru
            startGame();
        }

        // Inisialisasi game saat halaman dimuat
        window.EventListeneradd('DOMContentLoaded', init);
    </script>
</body>
</html>